// script.js
// Reemplaza las líneas siguientes con las oraciones de TU carta.
const lines = [
  "“Mi nombre es Schuwi… y morí de la forma más ridícula del mundo: intentando impresionar a una chica. Lo gracioso es que, en vez de morir de verdad, terminé renaciendo en un mundo mágico… con ella. Tati, la diosa del 18 de agosto. Y así empezó la aventura más absurda y hermosa de mi vida.”",
  "El sol brillaba sobre las colinas de Pastelvania, un reino donde las calles huelen a pan recién horneado y las nubes parecen algodones de azúcar. Caminábamos juntos: yo, con mi capa llena de remiendos (porque un héroe pobre también tiene estilo), y ella, radiante como si la luz la siguiera a todas partes. A nuestro lado, Lucky, su perro gigante, cuyo lomo parecía una colina peluda.",
  "—Schuwi, no te acerques a su cola —me advirtió Tati con esa voz dulce que esconde peligro.",
  "—¿Qué pasa si la to…? —y no terminé la frase porque Lucky me miró como si yo fuera un filete. Un paso en falso y ya estaba corriendo por mi vida.",
  "La diosa, entre risas, levantó su báculo (que parecía más un palo de escoba que un arma sagrada) y detuvo al monstruo de cuatro patas antes de que yo terminara como almuerzo canino.",
  "—Eres un desastre —me dijo—. Pero eres mi desastre.",
  "Y yo, sin aire por la persecución, supe que había valido la pena.",
  "Seguimos caminando por el Bosque de los Druidas, un lugar donde los árboles susurraban recetas de cocina y las ardillas llevaban sombreros de chef. Cada paso era una locura nueva:",
  "	•	Una rana parlante nos vendió mapas falsos… y nos convenció de comprar dos.",
  "	•	Un mercader nos ofreció una espada legendaria… que resultó ser un cuchillo para cortar queso.",
  "	•	Un druida nos pidió ayuda para encontrar a su unicornio… y el “unicornio” resultó ser una vaca con un cuerno de papel pegado.",
  "Pero Tati no dejaba de reír. Y cuando Tati ríe, el mundo se siente más ligero.",
  "En un claro del bosque, improvisamos un picnic. El manjar real: gansitos mágicos, jugo de fresa y un ceviche que olía sospechoso pero sabía glorioso. Mientras Lucky dormitaba, yo la miré y pensé que ni mil aventuras podrían superar este momento.",
  "Mientras Lucky roncaba como un trueno y el sol se filtraba entre las hojas, sentí un extraño escalofrío. El aire, que antes olía a pan dulce y fresas, de pronto se tornó frío y denso, como si alguien hubiera bajado las luces del mundo.",
  "—¿Tati…? —susurré, y ella ya estaba mirando a su alrededor con el ceño fruncido.",
  "—Esto no es normal —dijo, ajustando su báculo.",
  "Un segundo después, el cielo se agrietó. Sí, literalmente se agrietó, como si fuera de vidrio, y una luz blanca nos envolvió. Cuando abrí los ojos, ya no estábamos en el Bosque de los Druidas.",
  "Ahora estábamos en una ciudad silenciosa, cubierta por una neblina espesa que olía a lluvia y melancolía. Los edificios eran altos y retorcidos, como si hubieran sido dibujados por un artista con pesadillas. No había nadie, solo el eco de nuestros pasos y un cuervo que nos miraba desde un tejado.",
  "—¿Dónde estamos? —pregunté.",
  "—No lo sé, pero mantente cerca —respondió Tati, con esa mezcla de calma y determinación que me hace querer seguirla a cualquier parte.",
  "Avanzamos por calles empedradas hasta llegar a una plaza. En el centro, un reloj gigante marcaba una hora imposible: 25:61. Justo entonces, escuchamos un campanazo… y una voz, dulce pero inquietante, nos habló desde la nada:",
  "Bienvenidos al Ciclo. Sobrevivan… o vuelvan a empezar.",
  "No tuve tiempo de preguntar qué significaba. Una sombra gigantesca, con garras y ojos rojos, se deslizó desde los tejados hacia nosotros. Mi primera reacción fue obvia: correr. Pero Lucky, que había aparecido junto a nosotros, se lanzó contra la criatura como si fuera un héroe de leyenda.",
  "La pelea fue un caos: Tati lanzando hechizos que iluminaban la niebla como relámpagos, yo intentando golpear con una sartén (porque, claro, mi espada legendaria seguía siendo un cuchillo para queso), y Lucky mordiendo y esquivando como un demonio peludo.",
  "Justo cuando parecía que íbamos a perder, Tati me tomó de la mano.",
  "—Confía en mí —me dijo, y sus ojos brillaron.",
  "La luz nos envolvió otra vez, y en un parpadeo volvimos al inicio… al mismo callejón, a la misma neblina, al mismo reloj imposible. Era como si el tiempo se hubiera reiniciado.",
  "—¿Qué…? —alcancé a decir.",
  "—Es un bucle —respondió ella—. Estamos atrapados… hasta que encontremos la forma de romperlo.",
  "Y aunque la situación daba miedo, no pude evitar sonreír. Porque si iba a revivir mil veces el mismo día, al menos lo haría con ella.",
  "Revivimos ese mismo día más veces de las que puedo contar. Cada intento era diferente: en uno Lucky derrotaba al monstruo de un solo mordisco, en otro Tati lanzaba un hechizo tan potente que casi nos volaba a nosotros también, y en uno particularmente humillante… me tropecé y fui yo el que derrotó a la criatura, pero solo porque le caí encima de puro accidente.",
  "Entre bucle y bucle, empezamos a reírnos de lo absurdo que era todo. Sí, había peligro, niebla y relojes imposibles, pero cada vez que Tati me tomaba la mano para empezar de nuevo, sentía que lo importante no era ganar, sino vivirlo juntos.",
  "Finalmente, después de quién sabe cuántos reinicios, encontramos la forma de romper el ciclo: un portal escondido en la base del reloj gigante. Lo cruzamos, y todo se llenó de luz. Cuando mis ojos se acostumbraron, no estábamos en una ciudad oscura ni en un bosque encantado…",
  "Estábamos frente a una enorme mesa de banquete, iluminada por cientos de velas, con un festín digno de un vikingo: carne asada, pasteles de todos los sabores, empanadas, dulces y hasta un pastel enorme con el número de su cumpleaños tallado en azúcar.",
  "—¿Qué es esto? —preguntó Tati, sorprendida.",
  "—Es tu día —le respondí—. Y no importa cuántos mundos raros tengamos que atravesar, siempre voy a encontrar la manera de celebrarlo contigo.",
  "Ella sonrió, y en ese momento supe que no necesitaba ser un héroe legendario, ni tener una espada mágica, ni ganar batallas imposibles. Lo único que quería, en cualquier mundo y en cualquier vida, era verla feliz.",
  "Tati, mi diosa del 18 de agosto, que este nuevo año te traiga todo lo bonito que mereces. Que comas como un vikingo, que rías hasta que te duela la barriga, y que nunca olvides que siempre voy a estar a tu lado, apoyándote en cada aventura… y en cada bucle extraño que la vida nos ponga enfrente.",
  "Cuando creímos que el portal nos había devuelto a casa, un segundo resplandor nos envolvió. Abrí los ojos y, de pronto, estábamos en un castillo oscuro, gigantesco, con techos tan altos que parecían tocar las nubes. Tronos dorados, candelabros flotantes y, al fondo, un ejército entero de esqueletos armados hasta los dientes.",
  "—Schuwi… ¿dónde estamos? —susurró Tati, con ese tono que mezcla curiosidad y peligro.",
  "—En lo que, sospecho, es la peor idea del universo —le respondí, intentando parecer valiente mientras mi rodilla temblaba.",
  "De repente, desde el trono principal, una figura imponente se levantó: una calavera gigante vestida con túnicas negras y joyas imposibles. Su voz retumbó en todo el salón:",
  "—¡Bienvenidos, viajeros! ¿Quién osa entrar al Reino de los Mil No-Muertos?",
  "Yo abrí la boca para responder, pero Lucky, que claramente no entendía el protocolo, corrió directo a morderle la capa. El ejército entero se quedó paralizado. El “Señor Oscuro” bajó la mirada, vio al perro gigante y… se agachó para acariciarlo. Resulta que, en este mundo, Lucky era considerado un espíritu sagrado.",
  "Gracias a eso, pasamos de intrusos a invitados reales. Nos ofrecieron un banquete igual de exagerado que el castillo: carne de dragón, vino que brillaba como estrellas, pan horneado con magia y una sopa tan picante que me hizo ver visiones de mi infancia.",
  "Tati estaba fascinada, y yo… solo podía mirarla. En medio de toda esa locura de reinos, portales y mundos extraños, me di cuenta de algo: sin importar dónde caigamos, siempre vamos a encontrar una manera de reír, sobrevivir y seguir juntos.",
  "Cuando la noche terminó y el Señor Oscuro nos escoltó hasta otro portal de regreso, le susurré:",
  "—En cualquier mundo, Tati… yo elijo quedarme contigo.",
  "Y así, la diosa del 18 de agosto y su héroe remendado dejaron atrás castillos y esqueletos, para volver a su aventura más importante: la vida juntos.",
  "Tati, que este cumpleaños sea tan épico como nuestras historias. Que comas como un vikingo, que rías como si tuvieras un ejército de esqueletos celebrando contigo, y que sepas que, pase lo que pase, siempre voy a estar ahí, buscándote en todos los mundos posibles.",
  "El portal nos devolvió a la realidad… o al menos a una realidad menos cargada de calaveras gigantes. Cuando abrimos los ojos, estábamos otra vez en el Bosque de los Druidas, con sus árboles susurrantes, las ardillas chefs y ese aroma a pan que parece seguirnos a todos lados.",
  "Lucky corrió a espantar a una cabra con alas (que, por cierto, gritaba insultos en un idioma que no entendíamos), y Tati recogió unas flores que brillaban como luciérnagas.",
  "—Se siente bien estar de vuelta —me dijo.",
  "—Sí… aunque, técnicamente, no sé si esto cuenta como “volver a casa” —respondí, mientras una ardilla con bigote intentaba venderme una olla.",
  "Decidimos caminar hasta el Gremio de Aventureros, ese lugar donde todo huele a cerveza, madera vieja y promesas de trabajos imposibles. Apenas cruzamos la puerta, una ola de gritos y aplausos nos recibió.",
  "—¡Los héroes han vuelto! —gritó el tabernero, mientras dejaba caer una jarra rebosante de hidromiel frente a mí.",
  "—¡Y la diosa también! —corearon varios aventureros, levantando sus copas.",
  "La noche fue una locura:",
  "	•	El bardo del gremio improvisó una canción sobre cómo Lucky salvó al Reino de los Mil No-Muertos (aunque en realidad solo quería dormir).",
  "	•	Un mago borracho intentó convertir el hidromiel en oro y terminó con espuma de colores que olía a lavanda.",
  "	•	Y yo… yo intenté bailar con Tati. Lo logré durante unos segundos, hasta que mi pie se enredó con mi capa y caímos juntos, riendo como idiotas en medio del salón.",
  "Mientras todos celebraban, la miré y supe que no importaba cuántos mundos recorramos ni cuántas aventuras vivamos: ella siempre será mi misión más importante.",
  "Tati, que este cumpleaños sea tan brillante como los portales que cruzamos, tan feliz como esa noche en el gremio, y tan nuestro como todo lo que hemos vivido.",
  "Come como una reina vikinga, ríe como una diosa y recuerda siempre que, en cualquier mundo, yo voy a estar a tu lado.",
  "🌟 Mensaje final",
  "Tati, mi diosa del 18 de agosto, hoy es tu día especial. No habrá dragones, ni hechizos, ni perros gigantes que nos persigan (bueno, quizá Lucky, pero con cariño). Habrá comida de sobra, como un banquete vikingo, y sonrisas hasta que nos duela la cara.",
  "Quiero que sigas creciendo, no solo como la mujer increíble que ya eres, sino también como esa persona que transforma un día normal en una historia digna de contarse. Te amo demasiado, y en cada mundo, real o fantástico, siempre seré tu compañero de aventuras, tu escudo y tu desastre favorito.",
  "Feliz cumpleaños, Tati.",
  "Que este sea un capítulo legendario.",
  "FIN.",
];

const giftBtn = document.getElementById("gift");
const letter = document.getElementById("letter");
const resetBtn = document.getElementById("reset");
const revealAllBtn = document.getElementById("revealAll");

let index = 0;

// función que crea y muestra la siguiente línea
function revealNext() {
  // Si ya mostramos todo, nada más (o podrías reiniciar)
  if (index >= lines.length) {
    giftBtn.setAttribute("aria-expanded", "true");
    giftBtn.classList.add("open");
    return;
  }

  // quitar hint la primera vez
  const hint = letter.querySelector(".hint");
  if (hint) hint.remove();

  // crear párrafo
  const p = document.createElement("p");
  p.className = "line";
  p.textContent = lines[index];
  // añadir al contenedor
  letter.appendChild(p);

  // forzar reflow y luego mostrar con clase para animar
  requestAnimationFrame(() => p.classList.add("show"));

  index++;

  // si mostramos la última, abrimos la caja visualmente
  if (index === lines.length) {
    giftBtn.classList.add("open");
    giftBtn.setAttribute("aria-expanded", "true");
  }
}

// habilita teclado para el botón (Enter / Space)
giftBtn.addEventListener("keydown", (e) => {
  if (e.key === "Enter" || e.code === "Space" || e.key === " ") {
    e.preventDefault();
    revealNext();
  }
});

// click/tap
giftBtn.addEventListener("click", revealNext);

// Reiniciar todo
resetBtn.addEventListener("click", () => {
  index = 0;
  letter.innerHTML =
    '<p class="hint">Haz click en la caja para leer tu carta, frase por frase.</p>';
  giftBtn.classList.remove("open");
  giftBtn.setAttribute("aria-expanded", "false");
  giftBtn.focus();
});

// Mostrar todo de golpe (útil antes de regalar)
revealAllBtn.addEventListener("click", () => {
  while (index < lines.length) revealNext();
});

// accesibilidad: Si el usuario hace focus y presiona Enter, está cubierto por keydown handler.
// aria-live="polite" en el contenedor hace que lectores de pantalla anuncien nuevas líneas.
